<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salah Connect Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #050505; color: #eee; font-family: sans-serif; }
        .card { background: #111; border: 1px solid #222; border-radius: 20px; padding: 20px; }
        .accent { color: #10b981; }
    </style>
</head>
<body class="p-6">

    <div class="max-w-xl mx-auto">
        <header class="mb-10 flex justify-between items-center">
            <h1 class="text-2xl font-black">SALAH<span class="accent">CONNECT</span></h1>
            <div id="radar" class="text-[10px] font-bold px-3 py-1 bg-emerald-500/10 border border-emerald-500/20 rounded-full accent">RADAR ACTIVE</div>
        </header>

        <div id="display-area" class="space-y-4">
            <div class="text-center py-20">
                <p class="animate-pulse text-gray-500">Scanning Delhi-NCR for Masjids...</p>
            </div>
        </div>
    </div>

    <script>
    // --- DISTANCE CALCULATION (Haversine Formula) ---
    function getDistance(lat1, lon1, lat2, lon2) {
        const R = 6371; // Earth radius in km
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                  Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        const d = R * c;
        return d > 1 ? d.toFixed(1) + " km" : Math.round(d * 1000) + " m";
    }

    // --- LOGIC ENGINE --- (Fajr, Asr, Isha logic same rahega)
    function getJamaat(salah, start) {
        let [h, m] = start.split(':').map(Number);
        let t = h * 60 + m;
        if (salah === 'Fajr') {
            let n5 = Math.ceil(t / 5) * 5;
            return (n5 === t + 1) ? (n5 - 5) - 25 : n5 - 25;
        } else if (salah === 'Asr' || salah === 'Isha') {
            let rem = t % 15;
            return (rem === 0) ? t + 15 : (Math.ceil(t / 15) * 15) + 15;
        } else if (salah === 'Maghrib') return t + 7;
        return t; 
    }

    async function init() {
        navigator.geolocation.getCurrentPosition(async (pos) => {
            const { latitude, longitude } = pos.coords;
            
            const query = `[out:json];(node["amenity"="place_of_worship"]["religion"="muslim"](around:50000,${latitude},${longitude});way["amenity"="place_of_worship"]["religion"="muslim"](around:50000,${latitude},${longitude}););out center;`;
            const res = await fetch(`https://overpass-api.de/api/interpreter?data=${encodeURIComponent(query)}`).then(r => r.json());
            const prayerRes = await fetch(`https://api.aladhan.com/v1/timings?latitude=${latitude}&longitude=${longitude}&method=1`).then(r => r.json());
            
            const t = prayerRes.data.timings;
            const grid = document.getElementById('grid');
            grid.innerHTML = '';

            // Masjids ko distance ke hisaab se sort karna (Sabse paas wali pehle)
            const sortedMasjids = res.elements.map(m => {
                const mLat = m.lat || m.center.lat;
                const mLon = m.lon || m.center.lon;
                return { ...m, distanceVal: getDistance(latitude, longitude, mLat, mLon) };
            });

            sortedMasjids.forEach(m => {
                const name = m.tags.name || "Local Masjid";
                let html = `<div class="glass rounded-[2rem] p-8 relative overflow-hidden">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-xl font-bold text-emerald-500 truncate w-2/3">${name}</h3>
                        <span class="text-[10px] font-black bg-emerald-500/10 text-emerald-500 px-2 py-1 rounded-md uppercase">${m.distanceVal}</span>
                    </div>
                    <div class="space-y-3">`;
                
                ['Fajr', 'Zohr', 'Asr', 'Maghrib', 'Isha'].forEach(s => {
                    const baseTime = (s === 'Zohr') ? "13:30" : t[s === 'Maghrib' ? 'Maghrib' : (s === 'Fajr' ? 'Sunrise' : s)];
                    html += `
                        <div class="flex justify-between items-center border-b border-white/5 pb-2">
                            <span class="text-[9px] font-bold text-gray-500 uppercase tracking-widest">${s}</span>
                            <span class="text-sm font-mono font-bold">${fmt(getJamaat(s, baseTime))}</span>
                        </div>`;
                });

                html += `</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=${m.lat || m.center.lat},${m.lon || m.center.lon}" target="_blank" class="block mt-6 text-center text-[10px] font-bold text-emerald-500 border border-emerald-500/20 py-2 rounded-xl hover:bg-emerald-500 hover:text-white transition uppercase tracking-widest">Get Directions</a>
                </div>`;
                grid.innerHTML += html;
            });
        });
    }
    // ... (fmt function same rahegi) ...
</script>
</body>
</html>
